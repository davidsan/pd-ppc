/* * CULTO    : Concurrent UPMC LapTop Orchestra *            Exercice PPC - 2014 * * Exercice 2. Création d'un objet PureData de compteur borné donnant des listes de "pouet" en sortie * * author   : Philippe Esling *            <esling@ircam.fr> * */#include            <stdlib.h>#include            "multipouet.h"void                multipouet_bang(t_multipouet *m){    t_int           f = m->i_count;    t_int           step = m->step;    t_atom          *res;    int             i;        m->i_count += step;    if ((step > 0) && (m->i_count > m->i_max))    {        m->i_count = m->i_min;        outlet_bang(m->b_out);    }    else if (m->i_count < m->i_min)    {        m->i_count = m->i_max;        outlet_bang(m->b_out);    }    res = (t_atom *)calloc(f, sizeof(t_atom));    for (i = 0; i < f; i++)        SETSYMBOL(&(res[i]), gensym("pouet"));    outlet_list(m->p_out, gensym("pouet"), f, res);}void                multipouet_reset(t_multipouet *m){    m->i_count = m->i_min;}void                multipouet_set(t_multipouet *m, t_floatarg f){    m->i_count = f;}void                multipouet_bound(t_multipouet *m, t_floatarg f1, t_floatarg f2){    m->i_min = f1;    m->i_max = f2;}void                *multipouet_new(t_symbol *s, int argc, t_atom *argv){    t_multipouet    *m;        m = (t_multipouet *)pd_new(multipouet_class);    m->step = 1;    m->i_min = 0;    m->i_max = 10;    switch (argc)    {        case 3:            m->step = atom_getfloat(argv + (2 * sizeof(t_atom)));        case 2:            m->i_max = atom_getfloat(argv + (1 * sizeof(t_atom)));        case 1:            m->i_min = atom_getfloat(argv);        default:            break;    }    m->i_count = m->i_min;    floatinlet_new(&m->x_obj, &m->step);    inlet_new(&m->x_obj, &m->x_obj.ob_pd,              gensym("list"), gensym("bound"));    m->p_out = outlet_new(&m->x_obj, &s_list);    m->b_out = outlet_new(&m->x_obj, &s_bang);    return (void *)m;}void            multipouet_setup(void){    multipouet_class = class_new(gensym("multipouet"),                                 (t_newmethod)multipouet_new,                                 0, sizeof(t_multipouet),                                 CLASS_DEFAULT, A_GIMME, 0);    class_addbang(multipouet_class, multipouet_bang);    class_addmethod(multipouet_class, (t_method)multipouet_reset,                    gensym("reset"), 0);    class_addmethod(multipouet_class, (t_method)multipouet_set,                    gensym("set"), A_DEFFLOAT, 0);    class_addmethod(multipouet_class, (t_method)multipouet_bound,                    gensym("bound"), A_DEFFLOAT, A_DEFFLOAT, 0);}